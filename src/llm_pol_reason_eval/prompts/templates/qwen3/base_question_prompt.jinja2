{# Poprawiona wersja szablonu base_question_prompt.jinja2 dla rodziny qwen3 #}

{# 1. Najpierw jasno definiujemy instrukcję, która będzie na samej górze. #}
{% if template_params.get('enable_thinking') %}
{# Instrukcja dla trybu z myśleniem #}
Przeanalizuj poniższe zadanie krok po kroku, opierając się na załączonych tekstach. Swój tok rozumowania przedstaw w sekcji <thinking>, a następnie sformułuj ostateczną odpowiedź w sekcji <answer>.
{% else %}
{# Instrukcja dla trybu bez myślenia #}
Udziel odpowiedzi na poniższe zadanie, opierając się na załączonych tekstach.
{% endif %}

{# 2. Dołączamy przykłady "Few-Shot", jeśli są wymagane. #}
{% if 'few_shot' in components and template_params.few_shot_path %}
{% include template_params.few_shot_path %}
{% endif %}

{# 3. Dodajemy bardzo silny i jednoznaczny separator, który mówi modelowi "przykłady się skończyły". #}
---
### ZADANIE DO WYKONANIA
---
Teraz, na podstawie PONIŻSZYCH DANYCH, rozwiąż następujące zadanie:

{# 4. Renderujemy właściwe pytanie, kontekst i polecenie. #}
========================================
### ZADANIE {% if template_params.question_index %}{{ template_params.question_index }}{% else %}1{% endif %}

{% if question.get("context_ids") and contexts %}
### KONTEKST(Y)
{% for cid in question.get("context_ids", []) %}
{% if contexts.get(cid) %}
---
{{ contexts[cid].context_content }}
---
{% endif %}
{% endfor %}
{% endif %}

### POLECENIE
{{ question.question_text }}

{% if question.get("choices") %}
### OPCJE WYBORU
{% for choice in question.get("choices", []) %}
- {{ choice.choice_id }}: {{ choice.choice_text }}
{% endfor %}
{% endif %}

### ODPOWIEDŹ
{% if template_params.get('enable_thinking') %}<thinking>{% endif %}
